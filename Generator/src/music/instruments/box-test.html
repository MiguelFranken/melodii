<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>Box</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
</head>

<body>
    <button id="c4">C4</button>
    <button id="d4">D4</button>
    <button id="e4">E4</button>
    <button id="f4">F4</button>
    <button id="g4">G4</button>
    <button id="a4">A4</button>
    <button id="b4">B4</button>
    <button id="c5">C5</button>

    <style>
        button {
            width: 10em;
            height: 10em;
        }
    </style>

    <script src="https://cdn.jsdelivr.net/npm/socket.io-client@2/dist/socket.io.js"></script>
    <script>
        const socket = io("http://localhost:8080");

        socket.on('connect', () => console.log("Connected to socket."));
        socket.on('event', () => console.log("Received event."));
        socket.on('disconnect', () => console.log("Socket disconnected."));

        function trigger(note, velocity) {
            console.log(`Trigger ${note}.`);
            socket.emit(3, {
                address: "/box/trigger",
                args: [
                    { type: "s", value: note },
                    { type: "i", value: velocity }
                ],
                info: {},
            });
        }

        function release(note) {
            console.log(`Release ${note}.`);
            socket.emit(3, {
                address: "/box/release",
                args: [
                    { type: "s", value: note }
                ],
                info: {}
            });
        }

        const button_ids = ["C4", "D4", "E4", "F4", "G4", "A4", "B4", "C5"]
        for (id of button_ids) {
            let my_id = id;
            console.log(id);
            const el = document.getElementById(id.toLowerCase());
            el.addEventListener("mousedown", (event) => {
                const velocity = relativeHeight(event);
                trigger(my_id, velocity);
            })
            el.addEventListener("mouseup", () => {
                release(my_id);
            })
        }

        function relativeHeight(event) {
            const topZero = min(1, max(0, event.offsetY / event.target.offsetHeight));
            const bottomZero = 1 - topZero;
            return bottomZero;
        }
    </script>
</body>

</html>